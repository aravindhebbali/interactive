---
title: "Hacking strings with stringr"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(stringr)
library(tibble)
library(magrittr)
library(purrr)
library(dplyr)
knitr::opts_chunk$set(echo = FALSE)
mockstring <- readr::read_csv('https://raw.githubusercontent.com/rsquaredacademy/datasets/master/mock_strings.csv')
```

## Introduction

<hr>

In this module, we will learn to work with string data in R using [stringr](http://stringr.tidyverse.org). As we did in the earlier modules, we will use a case study to explore the various features of the stringr package. You can
download the data for the case study from [here](https://raw.githubusercontent.com/rsquaredacademy/datasets/master/mock_strings.csv) or directly import the data using the readr package.  Let us begin by installing and loading stringr and a set of other pacakges we will be using.


## Case Study

### Introduction

<hr>

- extract domain name from random email ids
- extract image type from url
- extract image dimension from url
- extract extension from domain name
- extract http protocol from url
- extract domain name from url
- extract extension from url
- extract file type from url


### Data

<hr>

```{r show, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Data'}
mockstring
```

### Data Dictionary

<hr>

## Case Study 1

### extract domain name from email ids

<hr>

```{r str2, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Domain Name'}
mockstring$email[1:2] %>% 
  str_split(pattern = '@') %>%
  unlist() %>%
  str_subset(pattern = '\\.') %>%
  str_split(pattern = '\\.') %>%
  purrr::map_chr(extract(1))
```

## Case Study 2

### Extract image type from URL

<hr>

```{r str3, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Image Type'}
mockstring$imageurl[1:5] %>%
  str_split(pattern = '\\.') %>%
  purrr::map_chr(extract(3)) %>%
  str_sub(start = 1, end = 3)

mockstring$imageurl[1:5] %>%
  str_split(pattern = '\\.') %>%
  purrr::map_chr(extract(3)) %>%
  str_split(pattern = '/') %>%
  purrr::map_chr(extract(1))
```

## Case Study 3

### Extract Image Dimesion from URL

<hr>

```{r str4, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Image Dimension'}
pattern <- "[:digits:]"
mockstring$imageurl[1:5] %>%
  str_locate(pattern = "[0-9]") 
  
mockstring$imageurl[1:5] %>%
  str_sub(start = 23) %>%
  str_split(pattern = '\\.') %>%
  purrr::map_chr(extract(1))
```

## Case Study 4
  
### Extract HTTP Protocol from URL

<hr>

```{r str6, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'HTTP Protocol'}
mockstring$url[1:5] %>%
  str_split(pattern = '://') %>%
  map_chr(extract(1))
  
k <- mockstring$url[1:5] %>%
  str_locate(pattern = '://') %>%
  data.frame() %>%
  extract2('start') %>%
  subtract(1)

mockstring$url[1:5] %>%
  str_sub(start = 1, end = k)
```

## Case Study 5

### Extract Domain Name

<hr> 

```{r str7, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Extract Domain Name'}
n <- mockstring$url[1:5] %>%
  str_locate_all(pattern = "/") %>%
  map_int(extract(3))

mockstring$url[1:5] %>%
  str_sub(end = n) %>%
  str_split(pattern = '\\.') %>%
  map_chr(extract(1)) %>%
  str_sub(start = k + 4)
```

## Case Study 6

### extract domain extension

<hr>

```{r str8, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Domain Extension'}
mockstring$url[1:5] %>%
  str_sub(end = n) %>%
  str_split(pattern = '\\.') %>%
  map_chr(extract(2)) %>%
  str_split(pattern = '/') %>%
  map_chr(extract(1))
```

## Case Study 7

### extract file type

<hr>

```{r str14, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Extract File Type'}
mockstring$url[1:3]
```

### Steps

<hr>

- check if there are only 2 dots in the URL
- check if there is only 1 question mark in the URL
- detect the location of the second dot 
- detect the location of the first question mark
- use the locations to specify the index position for extracting file type

### step 1: check if there are only 2 dots in the URL

<hr>

```{r str9, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'File Type - Step 1'}
mockstring$url[1:3] %>%
  str_locate_all(pattern = '\\.') %>%
  map_int(nrow) %>%
  is_greater_than(2) %>%
  sum()
```

### step 2: check if there is only 1 question mark in the URL

<hr>

```{r str10, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'File Type - Step 2'}  
mockstring$url[1:3] %>%
  str_locate_all(pattern = "[?]") %>%
  map_int(nrow) %>%
  is_greater_than(1) %>%
  sum()
```

### step 3: detect the location of the second dot

<hr>

```{r str11, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'File Type - Step 3'}
d <- mockstring$url[1:3] %>%
  str_locate_all(pattern = '\\.') %>%
  map_int(extract(2)) %>%
  add(1)

d  
```

### step 4: detect the location of the first question mark

<hr>

```{r str12, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'File Type - Step 4'}
q <- mockstring$url[1:3] %>%
  str_locate_all(pattern = "[?]") %>%
  map_int(extract(1)) %>%
  subtract(1)

q
```

### step 5: specify the index position for extracting file type

<hr>

```{r str13, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'File Type - Step 5'}
mockstring$url[1:3] %>% 
  str_sub(start = d, end = q)
```
