---
title: "Introduction to tibbles"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(tibble)
library(dplyr)
tutorial_options(exercise.timelimit = 0, exercise.cap = 'Sandbox')
knitr::opts_chunk$set(echo = FALSE)
```

## Introduction

tibbles are a modern version of data frames that retain the good aspects (of data frames) while getting rid of the
frustrating and annoying parts.  In this module, we will learn how tibbles makes certain parts of the data analysis 
workflow easier by being different from data frames. Specifically, we will learn

- what are tibbles?
- how are tibbles different from data frames?
- how to create tibbles?
- how to manipulate tibbles?


## Creating tibbles

tibbles can be created using any of the following:

- `tibble()`
- `as_tibble()`
- `tribble()`

```{r tibbles1, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Create tibble'}
tibble(x = letters,
       y = 1:26,
       z = sample(100, 26))
```

## tibble Features

- never changes input's types
- never adjusts variable names
- never prints all rows
- never recycles vector of length greater than 1

### Never change input's types

```{r tibbles2, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Input Type'}
tibble(x = letters,
       y = 1:26,
       z = sample(100, 26))
```

### Never adjusts variable names

```{r tibbles3, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Variable Names'}
# data frame
names(data.frame(`order value` = 10))

# tibble
names(tibble(`order value` = 10))
```

### Never print all rows

```{r tibbles4, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Limit Rows'}
x <- 1:100
y <- letters[1]
z <- sample(c(TRUE, FALSE), 100, replace = TRUE)
tibble(x, y, z)
```

### Never recycle vector of length greater than 1

```{r tibbles5, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Recycle Vector'}
x <- 1:100
y <- letters
z <- sample(c(TRUE, FALSE), 100, replace = TRUE)
tibble(x, y, z)
```

### Column Names

<hr>

Names of the columns in tibbles need not be valid R variable names. They can contain unusual characters like a space or a smiley but must be enclosed in ticks. 

```{r tibbles16, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Column Names'}
tibble(
  ` ` = 'space',
  `2` = 'integer',
  `:)` = 'smiley'
)
```


## Creating tibble II

In the previous section, we created tibbles using the `tibble()` function by directly entering data as arguments. In this section, we will convert the following objects to tibble using the `as_tibble()` function:

- data.frame
- list
- matrix
- table
- tbl_df
- atomic vectors


### DataFrames

<hr>

```{r tibbles6, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Data Frames'}
as_tibble(iris)
```

### Lists

<hr>

```{r tibbles7, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Lists'}
l <- list(x = 1:32, y = sample(100, 32), z = replicate(32, letters, simplify = FALSE))
as_tibble(l)
```

### Matrix

<hr>

```{r tibbles8, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Matrix'}
m <- matrix(sample(1000, 2600, replace = TRUE), ncol = 26)
colnames(m) <- letters
as_tibble(m)
```

### Table

<hr>

```{r tibbles9, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Table'}
k <- table(mtcars$cyl)
as_tibble(k)
```

### tbl_df

<hr>

```{r tibbles10, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'tbl_df'}
k <- tbl_df(iris)
as_tibble(k)
```

### atomic vectors

<hr>

```{r tibbles11, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Vectors I'}
browsers <- c('chrome', 'safari', 'firefox', 'edge')
enframe(browsers)
```

### atomic vectors

<hr>

```{r tibbles12, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Vectors II'}
browsers <- c(chrome = 40, firefox = 20, edge = 30, safari = 10)
enframe(browsers)
```

## tribble

### Introduction

<hr>

Another way to create tibbles is using `tribble()`: 

- it is short for transposed tibbles
- it is customized for data entry in code 
- column names start with `~` 
- and values are separated by commas

### Tribble

<hr>

```{r tibbles13, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'tribble'}
tribble(
  ~x, ~y, ~z,
  #--|--|----
  1, TRUE, 'a',
  2, FALSE, 'b'
)
```

## Compare tibbles

### Introduction

<hr>

We can compare tibbles using the `all_equal()` function from the [dplyr](http://dplyr.tidyverse.org/) package. We need to specify the 
tibbles being compared. Let us look at an example from the web traffic data. We have the details of browsers used in 2 formats. We will 
test if they are the same.

```{r tibbles17, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Compare tibbles'}
browsers1 <- enframe(c(chrome = 40, firefox = 20, edge = 30, safari = 10))
browsers2 <- enframe(c(edge = 30, firefox = 20, safari = 10, chrome = 40))
all_equal(browsers1, browsers2)
```

### Do not ignore row order

<hr>

 The `all_equal()` function ignores the order of the rows while comparing the tibbles. Change this by setting 
`ignore_row_order` to `TRUE`.

```{r tibbles18, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Compare tibbles - Part 2'}
all_equal(browsers1, browsers2, ignore_row_order = FALSE)
```


### Compare tibbles - Column Order

<hr>

The order of the columns are ignored by default.

```{r tibbles19, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Compare tibbles - Part 3'}
traffic1 <- tibble(
  browsers = c('chrome', 'firefox', 'edge', 'safari'),
  visit = c(40, 20, 30, 10),
  source = c('search', 'social', 'direct', 'affiliates'),
  visits = c(35, 25, 10, 30)
)

traffic2 <- tibble(
  source = c('search', 'social', 'direct', 'affiliates'),
  visits = c(35, 25, 10, 30),
  browsers = c('chrome', 'firefox', 'edge', 'safari'),
  visit = c(40, 20, 30, 10)
)

all_equal(traffic1, traffic2)
```


### Compare tibbles - Ignore Column Order

<hr>

Set `ignore_col_order` to `FALSE` to compare the order of the columns.

```{r tibbles20, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Compare tibbles - Part 4'}
all_equal(traffic1, traffic2, ignore_col_order = FALSE)
```

## Manipulate tibbles

### Add Rows

<hr>

Let us add data related to **Safari** browser to the web traffic data using the `add_row()` function.

```{r tibbles21, exercise = TRUE, exercise.eval = TRUE, exercise.cap = 'Add Rows'}
browsers <- enframe(c(chrome = 40, firefox = 20, edge = 30))
browsers
```

```{r tibbles22, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Add Rows'}
add_row(browsers, name = 'safari', value = 10)
```

### Add Rows

<hr>

If we want to add the data at a particular row, we can specify the row number using the `.before` argument.
Let us add the data related to **Safari** browser in the second row instead of the last row.

```{r tibbles23, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Add Rows'}
add_row(browsers, name = 'safari', value = 10, .before = 2)
```

### Add Column

<hr>

`add_col()` adds a new column to tibbles.

```{r tibbles24, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Add Column'}
browsers <- enframe(c(chrome = 40, firefox = 20, edge = 30, safari = 10))
add_column(browsers, visits = c(4000, 2000, 3000, 1000))
```

### Rownames

<hr>

The [tibble](tibble.tidyverse.org) package provides a set of functions to deal with rownames. Remember, `tibble` does
not have `rownames` unlike `data.frame`. To check whether a data set has rownames, use the `has_rownames()` function.

```{r tibbles25, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Rownames'}
has_rownames(mtcars)
```

### Remove Rownames

<hr>

```{r tibbles26, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Remove Rownames'}
remove_rownames(mtcars)
```

### Rownames to Column

<hr>

```{r tibbles27, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Rownames to Column'}
head(rownames_to_column(mtcars))
```

### Column to Rownames

<hr>

To convert the first column in the data set to rownames, use the `column_to_rownames()` function:

```{r tibbles28, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Column to Rownames'}
mtcars_tbl <- rownames_to_column(mtcars)
column_to_rownames(mtcars_tbl)
```

## Miscellaneous

### Test objects

<hr>

We can test if an object is a tibble using the `is_tibble()` function.

```{r tibbles14, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Test Objects'}
is_tibble(mtcars)
is_tibble(as_tibble(mtcars))
```

### Glimpse

<hr>

Use the `glimpse()` function to get an overview of the data.

```{r tibbles29, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Glimpse'}
glimpse(mtcars)
```

### Column Exists

<hr>

The `has_name()` function can be used to check if a tibble has a specific column.

```{r tibbles30, exercise = TRUE, exercise.eval = FALSE, exercise.cap = 'Column Exists'}
has_name(mtcars, 'cyl')
has_name(mtcars, 'gears')
```
